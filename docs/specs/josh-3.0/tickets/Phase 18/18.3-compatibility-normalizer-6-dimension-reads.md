# Ticket 18.3 — Compatibility Normalizer: 6-Dimension Reads (M)

## Role

Principal Full-Stack Engineer (TypeScript, compatibility pipeline, normalization, production-hardening, safe deprecations)

## Phase

Phase 18 — 6-Dimension Profile System

## Complexity

M

## What This Ticket Builds

Updates the compatibility normalizer so it reads the 3.0 coordination model:

- Reads the 6 dimension names from `profiles.coordination_dimensions` (JSONB)
- Removes all legacy 2.0 factor reads from the normalizer/scoring layer
- Ensures the normalizer safely handles profiles that have no dimension data (null defaults; no throws)

Also evaluates and removes (or deprecates) the legacy `compatibility-signal-writer.ts` from the active pipeline.

## Why It Matters

Phase 18 is migrating the system from 2.0 factor-based compatibility to 3.0 dimension-based compatibility. If the normalizer continues reading 2.0 factor names, we’ll produce mixed-format scoring inputs and silently degrade match behavior. This ticket makes the read path match the write path (Ticket 18.2) and prevents runtime crashes for partially-populated profiles.

## Behavioral Constraints

- No database schema changes.
- No migrations.
- No 2.0 factor name reads inside the normalizer after this ticket (examples include `interaction_style`, `conversation_style`, etc.).
- Normalizer must not throw when `coordination_dimensions` is missing/empty; return null defaults instead.
- Keep changes tightly scoped to the compatibility normalization pipeline and unit tests.
- Do not introduce dual-mode logic (“support both 12-factor and 6-dimension”) unless required solely for graceful defaults.

## Schema Changes

None.

## Runtime Changes

Compatibility normalization reads + any scoring/weighting functions directly referenced by `normalizer.ts` that still use 2.0 factor names.

## Dependencies

- Ticket 18.2 merged: profile writer persists 3.0 data into:
  - `profiles.coordination_dimensions`
  - `profiles.scheduling_availability`
  - `profiles.notice_preference`
  - `profiles.coordination_style`
- Ticket 17.1 merged: canonical 3.0 type definitions exist in `@josh/db` (CoordinationDimensions, etc.)
- Build plan requirements for this ticket are defined in Phase 18.

## Deliverables

### 1) Update normalizer.ts to Read 3.0 Coordination Dimensions

- Locate `normalizer.ts` in the repo (build plan calls it `packages/core/normalizer.ts`).
- Replace all reads of 2.0 factor names with reads from:
  - `profiles.coordination_dimensions`
- Ensure all 6 dimension names are read from the JSON object keyed by the 3.0 dimension keys (as written by Ticket 18.2).

### 2) Remove All 2.0 Factor Reads and Update Scoring/Weighting

- Remove reads of all 2.0 factor names from `normalizer.ts`.
- Update any scoring/weighting helpers referenced by `normalizer.ts` that still reference 2.0 factor names.

### 3) Graceful Defaults When No Dimension Data Exists

- If `coordination_dimensions` is null/undefined/empty, the normalizer must:
  - Return null defaults for the 6 dimension values (and any derived fields), and
  - Never throw.

### 4) Remove or Deprecate compatibility-signal-writer.ts

- Identify whether any 3.0 path actively consumes the output written by `compatibility-signal-writer.ts`.
- If there is **no active consumer**, delete `compatibility-signal-writer.ts` in this ticket.
- If a consumer exists:
  - Mark it `@deprecated`
  - Remove it from the active pipeline
  - Leave actual deletion for Ticket 21.4.

### 5) Tests

- Add/Update unit tests:
  - Normalizer returns correct 6 dimension values for a 3.0-shaped profile.
  - Normalizer returns defaults (nulls) for a profile with no dimension data.

## Verification Checklist

- Code hygiene:
  - No 2.0 factor name appears in `normalizer.ts` after this ticket.
- Repo checks:
  - `pnpm lint`
  - `pnpm typecheck`
  - `pnpm test` (known pre-existing failure on main may still exist; confirm on main if so)

Suggested greps:

- `rg -n "interaction_style|conversation_style|FINGERPRINT|fingerprint|factor" packages/core -S`
- `rg -n "compatibility-signal-writer" -S`
- `rg -n "coordination_dimensions" packages/core -S`

## Completion Criteria

Ticket is complete when:

- `normalizer.ts` reads 3.0 dimensions from `profiles.coordination_dimensions` and does not read any 2.0 factor names.
- Scoring/weighting functions referenced by `normalizer.ts` no longer reference 2.0 factor names.
- Missing dimension data returns null defaults (no throws).
- `compatibility-signal-writer.ts` is either deleted (if unused) or deprecated + removed from active pipeline (if still consumed).
- Unit tests cover both the 3.0-shaped profile and the no-dimension profile cases.
- Changes are committed and pushed on:
  - `ticket/18.3-compatibility-normalizer-6-dimension-reads`
- Final summary lists EVERY created/changed file with FULL repo-relative paths.
