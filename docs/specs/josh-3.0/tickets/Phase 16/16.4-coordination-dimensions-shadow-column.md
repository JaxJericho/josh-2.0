# Ticket 16.4 — Add coordination_dimensions Shadow Column

## Role

Principal Database Engineer

## Phase

Phase 16 — Schema Foundation

## Complexity

M

---

## What This Ticket Builds

This ticket introduces a **shadow storage column** on `profiles` to support the 6-dimension coordination model.

It does NOT:

- Remove legacy columns
- Replace existing coordination logic
- Change runtime behavior

It only prepares the schema for Phase 18 profile writer migration.

---

## Why It Matters

Phase 18 replaces the legacy 12-factor “Friend Fingerprint” with a 6-dimension coordination system:

- Energy
- Format
- Planning Style
- Group Size
- Social Intent
- Frequency

We need a structured JSONB container to hold these values while legacy fields still exist.

This is a shadow column migration.

---

## Behavioral Constraints

- Fully additive.
- No legacy column removal.
- No destructive migration.
- Column must be nullable.
- No default value.
- No backfill required.
- Replay-safe required.

---

## Schema Change

Add to `profiles`:

- `coordination_dimensions` jsonb nullable

No constraints required yet.

No index required yet.

---

## Migration Requirements

- Use `alter table if exists`.
- Use `add column if not exists`.
- Replay-safe.
- Idempotent.
- No data transformation.

---

## Dependencies

Requires:

- Ticket 16.1
- Ticket 16.2
- Ticket 16.3

Produces:

- Storage layer required for Phase 18 profile writer.
- Future compatibility for matching engine refactor.

---

## Deliverables

- Migration file:
  - `supabase/migrations/YYYYMMDDHHMMSS_ticket_16_4_coordination_dimensions_shadow.sql`

---

## Verification Checklist

After migration:

1. `coordination_dimensions` column exists on `profiles`.
2. Column type is jsonb.
3. Column is nullable.
4. Migration replays clean via `supabase db reset --no-seed`.
5. `pnpm lint`, `pnpm typecheck`, `pnpm test`, `pnpm build` pass.

---

## Completion Criteria

Ticket is complete when:

- Migration merged
- Migration applied to staging
- Column verified in staging
- Replay confirmed idempotent
- No runtime behavior changed
